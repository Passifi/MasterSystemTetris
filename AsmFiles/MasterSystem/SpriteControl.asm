
Offset equ 10
	include "F:\Files\Coding\RetroCoding\Z80\AsmFiles\MasterSystem\SMSBasic.asm"
	
	org &0000
	jp ProgramStart
	org &0008
	ds 8,&c9
	ds 8,&c9
	ds 8, &c9 
	ds 8, &c9 
	ds 8,&c9 
	ds 8, &c9 
	call INT 
	ret 
	org &0066	; Position of RMI Vector 
	ds 26,&c9 

ProgramStart:

	di
	im 1
	ld sp, Stack
	ld a,0
	ld (Trigger),a
	ld (MagScroll),a 
	call initializeVDP
	call InitSprites
	ld hl,MagScroll
	ld b,(hl)
	ld c,10 
	call WriteVDPRegister
	
	ei
main:
	
	jp main

	
	
INT: 
	push af
	
	
	in a,(&7E) ; read current Vertical Position  
	
	
	ld b,a
	ld a,(MagScroll) 
	sub a,b ; if we IRQ was on rasterline 5f call the midScreenINT routine 
	jp z,UpperInt
	ld hl, MagScroll 
	ld a,(hl)
	inc a
	ld b,a 
	sub &c1
	ld a,b
	jp nz, notEndOfLine
	ld a,0
notEndOfLine:
	
	ld (hl),a 
	call resetInt
	
	ld b,%11100000
	ld c,1
	call WriteVDPRegister
	
	
	
	call GetInput
	call setSprites
	call MoveMarker
	
	pop af
	in a,(vdpControl)
	
	ei
	ret 

UpperInt:
	
	ld b,%11100001
	ld c,1                             
	call WriteVDPRegister
	pop af
	in a,(vdpControl)
	ld a,(MagScroll)
	adc Offset
	ld b,a 
	ld c,10 
	call WriteVDPRegister
	ei
	ret 
	
resetInt:
	ld hl, MagScroll
	ld a,(hl) 
	ld b,a
	ld c,10 
	call WriteVDPRegister
	ret 
setSprites: 

	ld hl, SpriteAttribute+&80 
	call prepareVDP 
	ld a,(Sprite1Coord)
	out (vdpData),a 
	ld hl,SpriteAttribute
	call prepareVDP
	ld a,(Sprite1Coord+1)
	out (vdpData),a		
	
	ret 
	
MoveMarker: 
	ld hl, SpriteAttribute+8 
	call prepareVDP
	ld a,(MagScroll)
	out (vdpData),a 
	ld hl, SpriteAttribute+9 
	call prepareVDP
	ld a,(MagScroll)
	adc Offset
	out (vdpData),a 
	ret 
	
	
InitSprites:
	ld b,0 
	ld hl,SpriteAttribute+&81
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	
	call prepareVDP
	ld a,b
	out (vdpData),a 
	inc hl 
	inc hl 
	inc b 
	
	
	
	
	ret 

WriteVDPRegister: ; load into b the content of the data, the register no into c 
	ld a,b 
	out (vdpControl),a 
	ld a,c 
	and 15 
	or 128 
	out (vdpControl),a 
	ret 
	
	
	
GetInput:
	in a,(ControlRg)
	xor 255
	or a
	ret z
		ld b,a 
		and 8 
		jp z, PressedLeft 
PressedRight: 
		ld a,(Sprite1Coord)
		adc 8
		ld (Sprite1Coord),a 
		
PressedLeft:
		ld a,b 
		and 4 
		jp z,PressedUp 
		ld a,(Sprite1Coord)
		sbc 8
		ld (Sprite1Coord), a
	
	
PressedUp:
		ld a,b 
		and 1
		jp z, PressedDown
		ld a,(Sprite1Coord+1)
		sbc 8
		ld (Sprite1Coord+1),a 
		
PressedDown:
		ld a,b 
		and 2
		ret z 
		ld a,(Sprite1Coord+1)
		adc 8
		ld (Sprite1Coord+1),a 
		ret
		
StringTest:

	db "hello World" 
	
TileData:
	db &01, &00, &00, &00, &02, &01, &01, &00
	db &C1, &00, &00, &00, &FD, &00, &40, &00
	db &E3, &1C, &3C, &00, &3D, &02, &02, &00
	db &1A, &09, &05, &00, &2B, &08, &15, &00
	db &E0, &00, &00, &00, &F0, &00, &E0, &00
	db &78, &80, &F0, &00, &78, &80, &80, &00
	db &18, &D0, &E0, &00, &A8, &50, &50, &00
	db &FC, &00, &20, &00, &FA, &00, &04, &00
	db &23, &00, &1D, &00, &75, &32, &0B, &00
	db &BB, &34, &47, &00, &D9, &06, &27, &00
	db &FF, &00, &00, &00, &7F, &06, &00, &00
	db &35, &04, &0A, &00, &2F, &10, &10, &00
	db &FA, &00, &84, &00, &FD, &64, &02, &00
	db &CF, &00, &B0, &00, &FF, &00, &00, &00
	db &B6, &40, &60, &00, &20, &C0, &C0, &00
	db &E0, &00, &00, &00, &E0, &00, &00, &00
	db &37, &08, &00, &00, &37, &08, &00, &00
	db &2D, &12, &02, &00, &2B, &14, &06, &00
	db &57, &28, &0E, &00, &5F, &20, &0E, &00
	db &A7, &58, &1E, &00, &F5, &0A, &0E, &00
	db &E0, &00, &40, &00, &70, &80, &A0, &00
	db &F0, &00, &60, &00, &38, &C0, &F0, &00
	db &B8, &40, &70, &00, &9C, &60, &78, &00
	db &F4, &08, &18, &00, &44, &38, &38, &00
	db &33, &0C, &0C, &00, &7E, &00, &00, &00
	db &78, &00, &00, &00, &F1, &00, &00, &00
	db &B1, &00, &40, &00, &D1, &40, &20, &00
	db &B8, &30, &40, &00, &F8, &00, &00, &00
	db &7C, &00, &00, &00, &F8, &00, &00, &00
	db &F0, &00, &00, &00, &E0, &00, &00, &00
	db &E0, &00, &00, &00, &70, &00, &80, &00
	db &A8, &20, &50, &00, &F8, &00, &00, &00
	db &1F, &01, &00, &00, &15, &0A, &08, &00
	db &1A, &05, &01, &00, &25, &1A, &03, &00
	db &5B, &24, &07, &00, &73, &0C, &0F, &00
	db &16, &09, &0F, &00, &17, &08, &0F, &00
	db &F0, &80, &00, &00, &F0, &00, &00, &00
	db &C8, &30, &30, &00, &B4, &48, &58, &00
	db &DE, &20, &3C, &00, &8F, &70, &7E, &00
	db &C7, &38, &3E, &00, &F9, &06, &06, &00
	db &19, &06, &07, &00, &1E, &01, &01, &00
	db &7F, &00, &00, &00, &FE, &00, &00, &00
	db &D0, &00, &20, &00, &90, &00, &60, &00
	db &B8, &30, &40, &00, &F8, &00, &00, &00
	db &BF, &00, &00, &00, &9E, &00, &00, &00
	db &3C, &00, &00, &00, &78, &00, &00, &00
	db &78, &00, &00, &00, &5C, &00, &20, &00
	db &2E, &0C, &10, &00, &1E, &00, &00, &00

	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &67, &88, &00, &00, &6B, &94, &00
	db &00, &73, &8C, &00, &63, &63, &94, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &0C, &0C, &10, &00, &1C, &1C, &20, &00
	db &00, &0C, &10, &00, &00, &0C, &10, &00
	db &00, &0C, &10, &00, &0C, &0C, &10, &00
	db &1E, &1E, &20, &00, &00, &00, &1E, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &43, &A4, &00, &00, &06, &49, &00
	db &00, &1C, &22, &00, &31, &31, &4E, &00
	db &7F, &7F, &80, &00, &00, &00, &7F, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &03, &64, &00, &00, &1E, &21, &00
	db &00, &03, &1C, &00, &63, &63, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &36, &36, &48, &00, &66, &66, &98, &00
	db &00, &46, &A8, &00, &00, &46, &88, &00
	db &00, &7F, &80, &00, &06, &06, &79, &00
	db &06, &06, &08, &00, &00, &00, &06, &00
	db &7E, &7E, &80, &00, &60, &60, &9E, &00
	db &00, &7E, &80, &00, &00, &03, &7C, &00
	db &00, &03, &04, &00, &43, &43, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &60, &83, &00, &00, &7E, &80, &00
	db &00, &63, &9C, &00, &63, &63, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &7F, &7F, &80, &00, &63, &63, &9C, &00
	db &00, &03, &64, &00, &00, &06, &09, &00
	db &00, &06, &08, &00, &0C, &0C, &12, &00
	db &0C, &0C, &10, &00, &00, &00, &0C, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &3E, &41, &00
	db &00, &63, &9C, &00, &63, &63, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &3F, &40, &00
	db &00, &03, &3C, &00, &63, &63, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &18, &20, &00, &18, &18, &20, &00
	db &00, &00, &18, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &18, &20, &00, &18, &18, &20, &00
	db &08, &08, &10, &00, &10, &10, &28, &00
	db &00, &00, &00, &00, &18, &18, &20, &00
	db &18, &18, &20, &00, &00, &08, &10, &00
	db &00, &10, &28, &00, &00, &00, &10, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &3E, &40, &00
	db &00, &3E, &40, &00, &00, &00, &3E, &00
	db &00, &00, &00, &00, &00, &00, &00, &00
	db &3E, &3E, &40, &00, &43, &43, &BC, &00
	db &00, &43, &84, &00, &00, &0E, &51, &00
	db &00, &08, &16, &00, &00, &00, &08, &00
	db &08, &08, &10, &00, &00, &00, &08, &00
	db &3C, &3C, &40, &00, &42, &42, &BC, &00
	db &00, &99, &62, &00, &00, &A1, &5A, &00
	db &00, &A1, &42, &00, &99, &99, &22, &00
	db &42, &42, &9D, &00, &3C, &3C, &42, &00
	db &0F, &0F, &10, &00, &13, &13, &2C, &00
	db &00, &23, &54, &00, &00, &23, &44, &00
	db &00, &7F, &80, &00, &63, &63, &9C, &00
	db &63, &63, &84, &00, &00, &00, &63, &00
	db &7E, &7E, &80, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &7E, &81, &00
	db &00, &63, &9C, &00, &63, &63, &84, &00
	db &7E, &7E, &81, &00, &00, &00, &7E, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &60, &83, &00
	db &00, &60, &80, &00, &63, &63, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &7C, &7C, &82, &00, &66, &66, &99, &00
	db &00, &63, &84, &00, &00, &63, &84, &00
	db &00, &63, &84, &00, &66, &66, &89, &00
	db &7C, &7C, &82, &00, &00, &00, &7C, &00
	db &7F, &7F, &80, &00, &61, &61, &9E, &00
	db &00, &60, &81, &00, &00, &7C, &80, &00
	db &00, &60, &9C, &00, &61, &61, &82, &00
	db &7F, &7F, &80, &00, &00, &00, &7F, &00
	db &7F, &7F, &80, &00, &61, &61, &9E, &00
	db &00, &60, &81, &00, &00, &7C, &80, &00
	db &00, &60, &9C, &00, &60, &60, &80, &00
	db &70, &70, &80, &00, &00, &00, &70, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &60, &83, &00
	db &00, &6F, &90, &00, &63, &63, &84, &00
	db &3F, &3F, &40, &00, &00, &00, &3F, &00
	db &63, &63, &84, &00, &63, &63, &84, &00
	db &00, &63, &84, &00, &00, &7F, &80, &00
	db &00, &7F, &80, &00, &63, &63, &9C, &00
	db &63, &63, &84, &00, &00, &00, &63, &00
	db &3C, &3C, &40, &00, &18, &18, &24, &00
	db &00, &18, &20, &00, &00, &18, &20, &00
	db &00, &18, &20, &00, &18, &18, &20, &00
	db &3C, &3C, &40, &00, &00, &00, &3C, &00
	db &3F, &3F, &40, &00, &0C, &0C, &33, &00
	db &00, &0C, &10, &00, &00, &0C, &10, &00
	db &00, &0C, &10, &00, &4C, &4C, &90, &00
	db &38, &38, &44, &00, &00, &00, &38, &00
	db &63, &63, &84, &00, &66, &66, &89, &00
	db &00, &6C, &92, &00, &00, &78, &84, &00
	db &00, &6C, &90, &00, &66, &66, &88, &00
	db &63, &63, &84, &00, &00, &00, &63, &00
	db &60, &60, &80, &00, &60, &60, &80, &00
	db &00, &60, &80, &00, &00, &60, &80, &00
	db &00, &60, &80, &00, &63, &63, &84, &00
	db &7F, &7F, &80, &00, &00, &00, &7F, &00
	db &41, &41, &82, &00, &63, &63, &84, &00
	db &00, &77, &88, &00, &00, &7F, &80, &00
	db &00, &6B, &94, &00, &6B, &6B, &94, &00
	db &63, &63, &8C, &00, &00, &00, &63, &00
	db &43, &43, &84, &00, &63, &63, &84, &00
	db &00, &73, &84, &00, &00, &6B, &94, &00
	db &00, &67, &88, &00, &63, &63, &84, &00
	db &63, &63, &80, &00, &00, &00, &63, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &63, &84, &00
	db &00, &63, &84, &00, &63, &63, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &7E, &7E, &80, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &63, &84, &00
	db &00, &7E, &81, &00, &60, &60, &9E, &00
	db &60, &60, &80, &00, &00, &00, &60, &00
	db &3E, &3E, &40, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &63, &84, &00
	db &00, &6F, &90, &00, &6B, &6B, &94, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &7E, &7E, &80, &00, &63, &63, &9C, &00
	db &00, &63, &84, &00, &00, &7E, &81, &00
	db &00, &6C, &92, &00, &67, &67, &88, &00
	db &63, &63, &84, &00, &00, &00, &63, &00
	db &3E, &3E, &40, &00, &61, &61, &9E, &00
	db &00, &60, &81, &00, &00, &3E, &40, &00
	db &00, &03, &3C, &00, &43, &43, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &7F, &7F, &80, &00, &49, &49, &B6, &00
	db &00, &08, &51, &00, &00, &08, &10, &00
	db &00, &0C, &10, &00, &0C, &0C, &10, &00
	db &0C, &0C, &10, &00, &00, &00, &0C, &00
	db &63, &63, &84, &00, &63, &63, &84, &00
	db &00, &63, &84, &00, &00, &63, &84, &00
	db &00, &63, &84, &00, &63, &63, &84, &00
	db &3E, &3E, &41, &00, &00, &00, &3E, &00
	db &63, &63, &84, &00, &63, &63, &84, &00
	db &00, &63, &84, &00, &00, &63, &84, &00
	db &00, &36, &49, &00, &1C, &1C, &22, &00
	db &08, &08, &14, &00, &00, &00, &08, &00
	db &63, &63, &84, &00, &63, &63, &84, &00
	db &00, &6B, &94, &00, &00, &6B, &94, &00
	db &00, &7F, &80, &00, &77, &77, &88, &00
	db &22, &22, &55, &00, &00, &00, &22, &00
	db &63, &63, &84, &00, &36, &36, &49, &00
	db &00, &1C, &22, &00, &00, &1C, &20, &00
	db &00, &1C, &20, &00, &36, &36, &48, &00
	db &63, &63, &94, &00, &00, &00, &63, &00
	db &63, &63, &84, &00, &63, &63, &84, &00
	db &00, &36, &49, &00, &00, &1C, &22, &00
	db &00, &08, &14, &00, &0C, &0C, &10, &00
	db &0C, &0C, &10, &00, &00, &00, &0C, &00
	db &7F, &7F, &80, &00, &43, &43, &BC, &00
	db &00, &06, &49, &00, &00, &08, &16, &00
	db &00, &30, &49, &00, &61, &61, &92, &00
	db &7F, &7F, &80, &00, &00, &00, &7F, &00

		
TileDataEnd: 

TileMapIndex:
	db &00,&00
	db &01,&00
	db &02,&00
	db &03,&00 
TileMapIndexEnd: 

PaletteData: 
	db &00, &2A, &15, &00, &2E, &19, &04, &1B
	db &06, &01, &29, &14, &2F, &0B, &3E, &3F
	db &00, &00, &3F, &2B, &16, &3A, &35, &0F
	db &03, &02, &0C, &08, &0B, &07, &2A, &15


	
	
	org &c000
VarStart:

MagScroll: 
	db &00

; Sprite Variables

Sprite1Coord:
	db &00,&00
Sprite1CharCode: 
	db &00 
Sprite1Attributes:
	db &00 

Trigger:
	db &00

VarEnd:

	