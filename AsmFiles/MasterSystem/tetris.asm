	include "F:\Files\Coding\RetroCoding\Z80\AsmFiles\MasterSystem\SMSBasic.asm"
	
	org &0000
	jp ProgramStart
	org &0008
	ds 8,&c9
	ds 8,&c9
	ds 8, &c9 
	ds 8, &c9 
	ds 8,&c9 
	ds 8, &c9 
	call INT 
	ei
	ret 
	org &0066	; Position of RMI Vector 
	ds 26,&c9 
	
ProgramStart:

	di
	im 1
	ld sp, Stack
	ld a,0
	ld (PieceNo),a
	ld (Counter),a 
	ld (Counter+1),a 
	ld (CurrentPiece),a
	ld (rngIndex),a 
	ld hl, PieceXPos
	ld a, &F1
	ld (hl),a 
	ld hl, PieceYPos
	ld a, &0A
	ld (hl),a 
	
	call initializeVDP
	call initTMap
	
	ld b,4 
	ld hl, LineAddresses
	ld a, (hl)
	inc hl 
	ld d, (hl) 
	ld h,d 
	ld l,a 
	
	
	call drawPiece
	ei
	
main:
	
	jp main
	
INT: 
	di 
	
	; counter for timing counts to 65000~ 
	ld a, (counter)
	inc a 
	ld (counter),a 
	or a 
	ret nz
	ld a,(counter+1)
	inc a
	ld (counter+1),a
	or a 
	ret nz
	
	
	ld a,(PieceNo) 
	inc a 
	ld (PieceNo),a 
	cp 4 
	jp c, indexGood
	ld a,0
	ld (PieceNo),a
	
indexGood:
	ld c,a 
	ld b,4 
	ld ix, LineAddresses
	or a 
	jp z, loadInPiece
IncLoop:
	inc ix 
	inc ix 
	dec a 
	or a 
	jp nz, IncLoop
loadInPiece:	
	ld l, (ix) 
	ld h,(ix+1)
	
	ld (swapBuffer),hl 
	ld ix, (swapBuffer)
	
	call altPieces
	ret
	
altPieces:
	
	
	ld hl,SpriteAttribute
	call prepareVDP
	
	ld a,(ix+0)
	out (vdpData),a
	nop 
	nop 
	ld a,(ix+1)
	out (vdpData),a 
	nop 
	nop 
	ld a,(ix+2) 
	out (vdpData),a 
	nop 
	nop 
	ld a,(ix+3)
	out (vdpData),a 
	
	ld hl,SpriteAttribute+&80
	call prepareVDP
	
	ld a,(ix+4)
	out (vdpData),a 
	nop 
	nop
	ld a,b 
	out (vdpData),a 
	nop
	nop	
	ld a,(ix+5)
	out (vdpData),a 
	nop
	nop 
	ld a,b 
	out (vdpData),a 
	nop 
	nop 
	ld a,(ix+6)
	out (vdpData),a 
	nop 
	nop 
	ld a,b 
	out (vdpData),a 
	nop 
	nop 
	ld a,(ix+7)
	out (vdpData),a 
	nop 
	nop 
	ld a,b 
	out (vdpData),a 
	
	ret 
	
	
drawPiece:

	
	
	push hl ; hl contains address of piecedata
		ld hl, SpriteAttribute
		call prepareVDP
	pop hl 	
	
	ld a, (hl)
	inc hl 
	out (vdpData),a 
	
	ld a, (hl)
	inc hl 
	nop
	nop 
	out (vdpData),a 
	
	ld a, (hl)
	inc hl 
	nop
	nop 
	out (vdpData),a 
	
	ld a, (hl) 
	inc hl 
	nop
	nop 
	out (vdpData),a 
	
	nop
	nop 
	
	
	push hl 
	ld hl, SpriteAttribute+&80 
	call prepareVDP
	pop hl 
	
	ld a, (hl)
	inc hl 
	out (vdpData),a
	
	ld a,b
	nop
	nop 
	out (vdpData),a
	
	ld a, (hl)
	inc hl 
	nop 	
	nop 
	out (vdpData),a
	
	ld a,b
	nop
	nop 
	out (vdpData),a
	
	ld a, (hl)
	inc hl 
	nop
	nop	
	out (vdpData),a
	nop
	nop 
	ld a,b
	out (vdpData),a
	nop
	nop 
	ld a, (hl)
	inc hl 
	out (vdpData),a
	nop
	nop 
	ld a,b
	out (vdpData),a
	ret 
	; 00 - y + 80 - x 81 n 
	 
LineAddresses:
	dw Square, Line, Triangle, ZigZag1,ZigZag2,Square
	
Square: ; style first byte which char should be used next four bytes y coords next four bytes x chords
	db 0,0,8,8 
	db 0,8,0,8
Line:
	db 0,8,16,24
	db 0,0,0,0
	;rotated 
	db 0,0,0,0
	db 0,8,16,24
	
Triangle:
	
	db 0,8,8,8
	db 8,0,8,16
ZigZag1:
	db 10,10,18,18
	db 10,18,18,26
ZigZag2:
	db 18,18,10,10
	db 10,18,18,26
	
	
Tiledata:
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	
	db &00, &00, &00, &00
	db &3f, &00, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	
	db &00, &00, &00, &00
	db &ff, &00, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	db &7f, &3f, &00, &00
	
	db &00, &ff, &ff, &00
	db &3c, &c3, &ff, &00
	db &66, &81, &ff, &00
	db &42, &81, &ff, &00
	db &42, &81, &ff, &00
	db &66, &81, &ff, &00
	db &3c, &c3, &ff, &00
	db &00, &ff, &ff, &00

	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00

	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
	db &ff, &ff, &00, &00
TiledataEnd: 

PaletteData:
	db 63, 42, 21, 0, 20, 36, 52, 8, 24, 40, 56, 12, 28, 44, 60, 1
	db 63, 42, 21, 0, 20, 36, 52, 8, 24, 40, 56, 12, 28, 44, 60, 1

Tilemapdata:	
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &01, &00, &02, &00, &02, &00, &02, &00, &02, &00, &02, &00, &02, &00, &02, &00, &02, &00, &01, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &03, &02, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &01, &04, &02, &04, &02, &04, &02, &04, &02, &04, &02, &04, &02, &04, &02, &04, &02, &04, &01, &06, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00
	db &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00, &00 
TilemapdataEnd:

RNGStart:
	db &06, &06, &01, &01, &02, &00, &06, &06, &03, &05, &05, &04, &02, &01, &02, &04, &01, &06, &01, &02, &04, &00, &04, &00, &02, &00, &04, &00, &06, &06, &00, &06, &03, &06, &02, &02, &04, &06, &05, &05, &06, &02, &02, &02, &05, &02, &04, &00, &02, &01, &06, &04, &05, &03, &00, &00, &05, &06, &05, &05, &01, &03, &01, &06, &02, &06, &05, &06, &02, &04, &01, &04, &06, &06, &06, &03, &03, &03, &00, &01, &05, &01, &05, &00, &02, &06, &06
	db &02, &03, &03, &02, &06, &03, &04, &05, &04, &02, &00, &00, &03, &05, &05, &00, &04, &01, &03, &04, &06, &05, &03, &00, &03, &01, &00, &00, &01, &00, &00, &00, &05, &05, &00, &02, &05, &02, &04, &01, &04, &01, &06, &03, &02, &04, &06, &01, &03, &05, &00, &05, &01, &06, &05, &03, &02, &03, &02, &05, &03, &00, &04, &05, &06, &06, &06, &06, &02, &04, &00, &06, &00, &06, &05, &05, &04, &02, &03, &03, &06, &06, &06, &06, &05, &06, &02, &06, &03, &02, &06, &00, &06, &01, &03, &03, &04, &03, &02, &03, &01, &02, &03, &03, &04, &00, &01, &04, &00, &00, &04, &05, &04, &05, &01, &02, &02, &02, &06, &02, &06, &03, &03, &02, &01, &00, &02, &03, &05, &04, &05, &00, &06, &03, &01, &06, &01, &03, &06, &05, &06, &00, &02, &00, &02, &04 
	db &06, &02, &01, &03, &04, &01, &00, &05, &03, &06, &04, &06, &04, &05, &01, &00, &06, &00, &03, &03, &00, &06
RNGEnd:	

	org &c000
varStart:

PieceXPos:
	db &F1
PieceYPos:
	db &0A 
PieceNo:
	db &00 
Counter:
	db &00,&00
CurrentPiece:
	db &00
	
swapBuffer:
	db &00,&00
	
rngIndex: 
	db 00

varEnd: